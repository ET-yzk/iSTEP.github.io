<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="iSTEP">
    <meta name="description" content="iSTEP Blogs">
    <meta name="author" content="iSTEP">
    
    <title>
        
            iSTEP |
        
        iSTEP&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                iSTEP&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/changelog"
                            >
                                更新日志
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/changelog">更新日志</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">iSTEP</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">iSTEP</span>
                        
                            <span class="author-label">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-08-01 17:11:20
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.6k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>10 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="安装篇"><a href="#安装篇" class="headerlink" title="安装篇"></a>安装篇</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>OJ（OnlineJudge）是在线判题系统，很多学校或者机构打比赛都有自己的OJ系统。iSTEP项目基于QingdaoU开源项目<a class="link"   target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge" >OnlineJudge<i class="fas fa-external-link-alt"></i></a>。</p>
<p><strong>项目物理环境</strong>：</p>
<p>阿里云ECS Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz</p>
<p>4核 8G + 100G</p>
<h3 id="系统环境安装"><a href="#系统环境安装" class="headerlink" title="系统环境安装"></a>系统环境安装</h3><ul>
<li>pip</li>
<li>docker-compose (安装这个需要pip)</li>
<li>vim</li>
<li>git</li>
<li>curl</li>
<li>docker</li>
</ul>
<h4 id="Linux-环境"><a href="#Linux-环境" class="headerlink" title="Linux 环境"></a>Linux 环境</h4><details>
<summary>detail</summary>
pip
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install python3-pip</span><br><span class="line">pip install --upgrade pip  <span class="comment"># 升级一下pip</span></span><br></pre></td></tr></table></figure>
docker-compose
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose  <span class="comment"># 或者pip3</span></span><br><span class="line">docker-compose version  <span class="comment"># 显示版本号，确认安装成功</span></span><br></pre></td></tr></table></figure>
vim
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install vim</span><br></pre></td></tr></table></figure>
git
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure>
curl
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apy install curl</span><br></pre></td></tr></table></figure>
docker
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>
</details>

<ol>
<li><p>安装必要的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y vim python3-pip curl git</span><br><span class="line">pip3 install --upgrade pip</span><br><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure></li>
<li><p>安装 Docker</p>
<p>使用脚本一键安装</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>

<p>详细步骤参照： <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/install/" >https://docs.docker.com/install/<i class="fas fa-external-link-alt"></i></a></p>
</li>
</ol>
<h4 id="Windows环境不推荐"><a href="#Windows环境不推荐" class="headerlink" title="Windows环境不推荐"></a>Windows环境不推荐</h4><p>Windows 下的安装仅供体验，勿在生产环境使用。如有必要，请使用虚拟机安装 Linux 并将 OJ 安装在其中。</p>
<p>以下教程仅适用于 Win10 x64 下的 <code>PowerShell</code></p>
<ol>
<li>安装 Windows 的 Docker 工具</li>
<li>右击右下角 Docker 图标，选择 Settings 进行设置</li>
<li>选择 <code>Shared Drives</code> 菜单，之后勾选你想安装 OJ 的盘符位置（例如勾选D盘），点击 <code>Apply</code></li>
<li>输入 Windows 的账号密码进行文件共享</li>
<li>安装 <code>Python</code>、<code>pip</code>、<code>git</code>、<code>docker-compose</code>，安装方法自行搜索。</li>
</ol>
<h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><ol>
<li><p>请选择磁盘空间富余的位置，运行下面的命令</p>
<p><em><strong>TODO: 替换为 iSTEP</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b 2.0 https://github.com/QingdaoU/OnlineJudgeDeploy.git &amp;&amp; cd OnlineJudgeDeploy</span><br></pre></td></tr></table></figure></li>
<li><p>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
</ol>
<p>根据网速情况，大约5到30分钟就可以自动搭建完成，全程无需人工干预。</p>
<p>等命令执行完成，然后运行 <code>docker ps -a</code>，当看到所有的容器的状态没有 <code>unhealthy</code> 或 <code>Exited (x) xxx</code> 就代表 OJ 已经启动成功。</p>
<h3 id="尽情享用吧"><a href="#尽情享用吧" class="headerlink" title="尽情享用吧"></a>尽情享用吧</h3><p>通过浏览器访问服务器的 HTTP 80 端口或者 HTTPS 443 端口（默认可<a class="link"   target="_blank" rel="noopener" href="http://localhost/" >本地访问<i class="fas fa-external-link-alt"></i></a>），就可以开始使用了。后台管理路径为<code>/admin</code>, 安装过程中自动添加的超级管理员用户名为 <code>root</code>，密码为 <code>rootroot</code>， <strong>请务必及时修改密码</strong>。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://opensource.qduoj.com/#/onlinejudge/guide/deploy" >这里是QingDaoU的文档<i class="fas fa-external-link-alt"></i></a></p>
<hr>
<h2 id="部署篇"><a href="#部署篇" class="headerlink" title="部署篇"></a>部署篇</h2><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><table>
<thead>
<tr>
<th align="left">文件夹</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">build</td>
<td align="left">项目构建相关webpack相关</td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">项目配置目录，端口之类的</td>
</tr>
<tr>
<td align="left">deploy</td>
<td align="left">一部分配置文件</td>
</tr>
<tr>
<td align="left">node_modules</td>
<td align="left">npm加载的项目的依赖项，默认没有，执行npm install 后产生</td>
</tr>
<tr>
<td align="left">package.json</td>
<td align="left">项目配置文件</td>
</tr>
<tr>
<td align="left">README.md</td>
<td align="left">项目说明文档</td>
</tr>
<tr>
<td align="left">src</td>
<td align="left">二次开发的主要目录，页面等</td>
</tr>
<tr>
<td align="left">static</td>
<td align="left">静态文件，js,css文件</td>
</tr>
<tr>
<td align="left">dist</td>
<td align="left">打包后的文件，用于部署，执行npm run build 后产生</td>
</tr>
</tbody></table>
<h4 id="Linux安装指定版本node-js（npm）"><a href="#Linux安装指定版本node-js（npm）" class="headerlink" title="Linux安装指定版本node.js（npm）"></a>Linux安装指定版本node.js（npm）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash  -  <span class="comment"># 8可改为需要的版本，本项目要求8</span></span><br><span class="line">sudo apt-get install -y nodejs  <span class="comment"># ubuntu</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Windows只需下载相应文件，添加环境变量即可：</p>
<p><code>系统属性=&gt;高级=&gt;环境变量=&gt;系统变量=&gt;选择 &#39;PATH&#39; 编辑=&gt;添加 node.js 安装路径</code></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://nodejs.org/zh-cn/download/releases/" >以往的版本 | Node.js (nodejs.org)<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h4 id="本地运行前端"><a href="#本地运行前端" class="headerlink" title="本地运行前端"></a>本地运行前端</h4><h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line"><span class="comment"># we use webpack DllReference to decrease the build time,</span></span><br><span class="line"><span class="comment"># this command only needs execute once unless you upgrade the package in build/webpack.dll.conf.js</span></span><br><span class="line"><span class="built_in">export</span> NODE_ENV=development </span><br><span class="line">npm run build:dll</span><br><span class="line"></span><br><span class="line"><span class="comment"># the dev-server will set proxy table to your backend</span></span><br><span class="line"><span class="built_in">export</span> TARGET=http://Your-backend</span><br><span class="line"></span><br><span class="line"><span class="comment"># serve with hot reload at localhost:8080</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line"><span class="comment"># we use webpack DllReference to decrease the build time,</span></span><br><span class="line"><span class="comment"># this command only needs execute once unless you upgrade the package in build/webpack.dll.conf.js</span></span><br><span class="line"><span class="built_in">set</span> NODE_ENV=development </span><br><span class="line">npm run build:dll</span><br><span class="line"></span><br><span class="line"><span class="comment"># the dev-server will set proxy table to your backend</span></span><br><span class="line"><span class="built_in">set</span> TARGET=http://Your-backend</span><br><span class="line"></span><br><span class="line"><span class="comment"># serve with hot reload at localhost:8080</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h4 id="部署前端代码"><a href="#部署前端代码" class="headerlink" title="部署前端代码"></a>部署前端代码</h4><p>打开终端，将当前位置切换到相应的目录，然后执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>等待一会，会提示成功，目录下会多出一个 dist 文件，结构如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  OnlineJudgeFE git:(master) ✗ tree dist  <span class="comment"># [sudo apt install tree]</span></span><br><span class="line">dist </span><br><span class="line">├── admin </span><br><span class="line">│   └── index.html </span><br><span class="line">├── index.html </span><br><span class="line">└── static    </span><br><span class="line">​	├── css    </span><br><span class="line">​	│   ├── admin.127f3da5b09451926728de2829ebb32e.css    </span><br><span class="line">​	│   ├── loader.css    </span><br><span class="line">​	│   ├── oj.0ba722f43ddbeb758cde2f9dc804455e.css    </span><br><span class="line">​	│   └── vendor.f033d6c4c74b6b40e92ca86f168fd0be.css    </span><br><span class="line">​	├── fonts   </span><br><span class="line">​	│   ├── KaTeX_AMS-Regular.3d8245d.woff2    </span><br><span class="line">​	│   ├── KaTeX_AMS-Regular.ac1d46d.woff</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>将 <code>dist</code> 文件夹复制到服务器上某个目录下，比如 <code>~/backend/dist</code>，然后修改 <code>docker-compose.yml</code>，在 <code>oj-backend</code> 模块中的 <code>volumes</code> 中增加一行 <code>- ~/backend/dist:/app/dist</code> （冒号前面的请修改为实际的路径），然后 <code>docker-compose up -d</code> 即可。</p>
<p>注意，这种修改方式将覆盖容器内的前端文件，未来发布新版本前端的时候，请自行使用相同的方式更新。</p>
<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><table>
<thead>
<tr>
<th align="left">文件夹</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="配置本地后端环境"><a href="#配置本地后端环境" class="headerlink" title="配置本地后端环境"></a>配置本地后端环境</h4><h4 id="本地运行后端"><a href="#本地运行后端" class="headerlink" title="本地运行后端"></a>本地运行后端</h4><ol>
<li>Pycharm 克隆项目后可直接运行：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 127.0.0.1:8000</span><br><span class="line"><span class="comment"># OR: py manage.py runserver 127.0.0.1:8000 [运行的ip及端口]</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="部署修改的后端代码"><a href="#部署修改的后端代码" class="headerlink" title="部署修改的后端代码"></a>部署修改的后端代码</h4><ol>
<li><p>通过<code>docker exec -it istep-backend sh</code>直接进入容器的<code>/app</code>目录下修改，可以借助<code>git</code>快速更新文件</p>
</li>
<li><p>或者，直接将<code>/app</code>目录挂载到本地进行修改：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">oj-backend:</span></span><br><span class="line">	<span class="attr">volumes:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">本地目录:/app【docker</span> <span class="string">image中的位置】</span></span><br><span class="line"><span class="comment"># 注: 此时前端 [dist] 部署可直接在该目录修改</span></span><br></pre></td></tr></table></figure>

<p>如图：               <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://gitee.com/yzketx/image-markdown/raw/master/img/image-20210730203946862.png"
                      alt="image-20210730203946862" style="zoom:60%;" 
                ></p>
</li>
</ol>
<h3 id="打包镜像"><a href="#打包镜像" class="headerlink" title="打包镜像"></a>打包镜像</h3><h4 id="1-在此之前：我们需要在阿里云上注册一个docker的镜像仓库。"><a href="#1-在此之前：我们需要在阿里云上注册一个docker的镜像仓库。" class="headerlink" title="(1) 在此之前：我们需要在阿里云上注册一个docker的镜像仓库。"></a>(1) 在此之前：我们需要在阿里云上注册一个docker的镜像仓库。</h4><p><a class="link"   target="_blank" rel="noopener" href="https://www.longkui.site/development/docker2/" >注册方法及简单使用方法请点这里。<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="2-然后我们需要将onlinejudge恢复到最初始的状态，就是你一键安装完毕那个状态。（如果你在上一步更改过docker-compose-yml-文件，记得改回来并重新docker-compose-up-d）"><a href="#2-然后我们需要将onlinejudge恢复到最初始的状态，就是你一键安装完毕那个状态。（如果你在上一步更改过docker-compose-yml-文件，记得改回来并重新docker-compose-up-d）" class="headerlink" title="(2) 然后我们需要将onlinejudge恢复到最初始的状态，就是你一键安装完毕那个状态。（如果你在上一步更改过docker-compose.yml 文件，记得改回来并重新docker-compose up -d）"></a>(2) 然后我们需要将onlinejudge恢复到最初始的状态，就是你一键安装完毕那个状态。（如果你在上一步更改过docker-compose.yml 文件，记得改回来并重新docker-compose up -d）</h4><h4 id="3-然后切换到我们修改过的前端的目录下-先查看下我们前端镜像的ID"><a href="#3-然后切换到我们修改过的前端的目录下-先查看下我们前端镜像的ID" class="headerlink" title="(3) 然后切换到我们修改过的前端的目录下,先查看下我们前端镜像的ID"></a>(3) 然后切换到我们修改过的前端的目录下,先查看下我们前端镜像的ID</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h4 id="4-先把oj-backend的容器ID拷贝下来，一会要用。"><a href="#4-先把oj-backend的容器ID拷贝下来，一会要用。" class="headerlink" title="(4) 先把oj-backend的容器ID拷贝下来，一会要用。"></a>(4) 先把oj-backend的容器ID拷贝下来，一会要用。</h4><p>然后我们执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=production npm run build:dll</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h4 id="5-打包完成后，我们还是把dist里的内容注入到docker容器中，我们执行"><a href="#5-打包完成后，我们还是把dist里的内容注入到docker容器中，我们执行" class="headerlink" title="(5) 打包完成后，我们还是把dist里的内容注入到docker容器中，我们执行"></a>(5) 打包完成后，我们还是把dist里的内容注入到docker容器中，我们执行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp ./dist  xxxxxxxxxxxxx:/app/</span><br><span class="line"><span class="comment">#这里 xxxxxxxxxxxxx 是我们刚才查看的oj-backend的容器ID，注意容器ID和冒号之间没有空格</span></span><br></pre></td></tr></table></figure>

<h4 id="6-然后将注入后的容器打包成本地镜像"><a href="#6-然后将注入后的容器打包成本地镜像" class="headerlink" title="(6) 然后将注入后的容器打包成本地镜像"></a>(6) 然后将注入后的容器打包成本地镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m <span class="string">&quot;提示信息&quot;</span> -a <span class="string">&quot;作者&quot;</span>   容器ID  镜像名称</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其中, 容器ID是上面的 xxxxxxxxxxxxx, 镜像名称可以自己起一个, 成功之后会有一个值生成</span></span><br></pre></td></tr></table></figure>

<p>执行docker images后会有以下界面，我们复制刚才我们创建的镜像<code>ID: xxxxxxxxxxxxx</code>，一会要用。</p>
<h4 id="7-把打包好的镜像push到阿里云仓库"><a href="#7-把打包好的镜像push到阿里云仓库" class="headerlink" title="(7) 把打包好的镜像push到阿里云仓库"></a>(7) 把打包好的镜像push到阿里云仓库</h4><p>根据这篇文章中提到的阿里云仓库的注册方法,阿里提供了pull到仓库的方法, 建议打开你自己复制下来以备后用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker login --username=你的用户名 registry.xxx.aliyuncs.com</span><br><span class="line">sudo docker tag [镜像ID] registry.xxx.aliyuncs.com/你的命名空间/项目名字:[镜像版本号]</span><br><span class="line">sudo docker push registry.xxx.aliyuncs.com/你的命名空间/项目名字:[镜像版本号]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意,提交的时候没有中括号</span></span><br></pre></td></tr></table></figure>

<p>等待一会就push成功了。</p>
<p>在 阿里云控制台 “镜像版本” 可中看到上传的版本。</p>
<h4 id="8-拉取镜像"><a href="#8-拉取镜像" class="headerlink" title="(8) 拉取镜像"></a>(8) 拉取镜像</h4><p>复制上传完毕后的仓库的公有地址，把它替换到<code>docker-compose.yml</code>文件中 image 参数的位置，注意镜像地址要带版本号。</p>
<p>保存之后，就在一键安装文件夹下面重新 执行 docker-compose up -d 生效。</p>
<hr>
<h2 id="迁移篇"><a href="#迁移篇" class="headerlink" title="迁移篇"></a>迁移篇</h2><h3 id="如何备份"><a href="#如何备份" class="headerlink" title="如何备份"></a>如何备份</h3><p>为了保证数据安全，请定期备份。</p>
<p>OnlineJudgeDeploy 目录中的 <code>data</code> 文件夹是系统的所有的数据，包括日志，数据库，测试用例，上传的文件等，其中需要备份的数据为 <code>backend/public</code>，<code>backend/test_case</code> 两个目录。</p>
<p><strong>对于数据库，请不要使用复制数据库数据文件的方法</strong>。在最新的 OnlineJudgeDeploy 中，<code>backup</code> 目录提供了数据库导出 sql 文件备份脚本，请每次备份后检查生成的 sql 文件的大小和内容，确保备份成功。</p>
<p>请不要把备份数据和 OnlineJudge 系统放在同一台机器上，这样数据丢失的风险仍然较高。</p>
<h3 id="恢复备份"><a href="#恢复备份" class="headerlink" title="恢复备份"></a>恢复备份</h3><p>如果只是想不同机器之间迁移部署，<code>docker stop $(docker ps -aq)</code> 然后复制 <code>OnlineJudgeDeploy</code> 文件夹到新机器后重新 <code>docker-compose up -d</code> 即可。</p>
<p>如果要恢复数据，首先要保证已经新部署了一套 OnlineJudge，然后需要恢复数据和测试用例文件。</p>
<p>测试用例存储在 <code>data/backend/test_case</code> 文件夹中，覆盖即可。</p>
<p>在新的机器上执行下面的操作可以恢复数据库</p>
<ul>
<li><p><code>docker cp db_backup_xxxxxxx.sql oj-postgres:/root</code></p>
</li>
<li><p><code>docker exec -it oj-postgres bash</code></p>
</li>
<li><p><code>psql -U postgres</code> 然后运行 <code>drop database onlinejudge;</code> (<strong>请一定注意！！！看清楚在哪台机器上</strong>）</p>
</li>
<li><p><code>\q</code> 退出，然后 <code>psql -f /root/db_backup_xxxxxxx.sql -U postgres</code></p>
</li>
</ul>
<hr>
<h2 id="多个评测机"><a href="#多个评测机" class="headerlink" title="多个评测机"></a>多个评测机</h2><p>多个评测机只需确保两点即可正常运行:</p>
<ul>
<li>JudgeServer Token 一致</li>
<li>进行测试用例的多机同步</li>
</ul>
<p>iSTEP 使用 <code>rsync</code> 进行同步，步骤如下:</p>
<h3 id="在部署好的机器上开启测试用例同步-master-服务"><a href="#在部署好的机器上开启测试用例同步-master-服务" class="headerlink" title="在部署好的机器上开启测试用例同步 master 服务"></a>在部署好的机器上开启测试用例同步 master 服务</h3><p>在已经部署好的服务器上，修改 <code>OnlineJudgeDeploy</code> 里的 <code>docker-compose.yml</code> 文件</p>
<p>将下列代码合并进去(即添加一个service，注意缩进), 并运行<code>docker-compose up -d</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oj-rsync-master:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/onlinejudge/oj_rsync</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">oj-rsync-master</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$PWD/data/backend/test_case:/test_case:ro</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$PWD/data/rsync_master:/log</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_MODE=master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_USER=ojrsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_PASSWORD=CHANGE_THIS_PASSWORD</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;0.0.0.0:873:873&quot;</span></span><br></pre></td></tr></table></figure>

<p>请务必修改<code>RSYNC_PASSWORD</code>，否则会导致测试用例的泄露</p>
<h3 id="在新的机器上配置-JudgeServer-和测试用例同步-slave-服务"><a href="#在新的机器上配置-JudgeServer-和测试用例同步-slave-服务" class="headerlink" title="在新的机器上配置 JudgeServer 和测试用例同步 slave 服务"></a>在新的机器上配置 JudgeServer 和测试用例同步 slave 服务</h3><p>在新的的机器上按照 <code>OnlineJudgeDeploy</code> 项目初始化环境，修改 <code>docker-compose.yml</code>，只需要保留 <code>judge-server</code> 一个 service，然后添加下面的 service 到文件中。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oj-rsync-slave:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/onlinejudge/oj_rsync</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">oj-rsync-slave</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$PWD/data/backend/test_case:/test_case</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$PWD/data/rsync_slave:/log</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_MODE=slave</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_USER=ojrsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_PASSWORD=CHANGE_THIS_PASSWORD</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RSYNC_MASTER_ADDR=YOUR_BACKEND_ADDR</span></span><br></pre></td></tr></table></figure>

<p>请同步修改 <code>RSYNC_PASSWORD</code>，并将 <code>RSYNC_MASTER_ADDR</code> 修改为运行了 <code>oj-rsync-master</code> 服务的地址，不需要端口号，如 <code>example.com</code> 或者 <code>192.168.1.10</code>。</p>
<p>然后给 JudgeServer 添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;0.0.0.0:80:8080&quot;</span></span><br></pre></td></tr></table></figure>

<p>的端口配置，同时还需要修改</p>
<ul>
<li><code>SERVICE_URL</code> 为新的机器的地址</li>
<li><code>BACKEND_URL</code> 的域名为已部署好的主机的地址</li>
<li><code>TOKEN</code> 和已部署好主机 <code>TOKEN</code> 一致。</li>
</ul>
<p>运行 <code>docker-compose up -d</code> 即可启动一台新的 JudgeServer，<code>tail -f data/rsync_slave/rsync_slave.log</code> 可以看到测试用例同步进度，在已部署好主机的后台可以看到新的 JudgeServer 的心跳状态。</p>
<hr>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：iSTEP</li>
        <li>本文作者：iSTEP</li>
        <li>创建时间：2021-08-01 17:11:20</li>
        <li>
            本文链接：https://istep.github.io/2021/08/01/iSTEP/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/08/01/Django-session/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Django-session</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/08/01/hello-world/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Hello World</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="twikoo-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/twikoo@1.0.0/dist/twikoo.all.min.js"
        ></script>
        <div id="twikoo-comment"></div>
        <script data-pjax>
            function loadTwikoo() {
                twikoo.init({
                    el: '#twikoo-comment',
                    envId: 'hello-cloudbase-6gszkpzn777e377d',
                    region: '',
                });
            }

            if ('true') {
                const loadTwikooTimeout = setTimeout(() => {
                    loadTwikoo();
                    clearTimeout(loadTwikooTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadTwikoo);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">iSTEP</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%AF%87"><span class="nav-text">安装篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="nav-text">系统环境安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux-%E7%8E%AF%E5%A2%83"><span class="nav-text">Linux 环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows%E7%8E%AF%E5%A2%83%E4%B8%8D%E6%8E%A8%E8%8D%90"><span class="nav-text">Windows环境不推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85"><span class="nav-text">开始安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%BD%E6%83%85%E4%BA%AB%E7%94%A8%E5%90%A7"><span class="nav-text">尽情享用吧</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E7%AF%87"><span class="nav-text">部署篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF"><span class="nav-text">前端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%ACnode-js%EF%BC%88npm%EF%BC%89"><span class="nav-text">Linux安装指定版本node.js（npm）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C%E5%89%8D%E7%AB%AF"><span class="nav-text">本地运行前端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Linux"><span class="nav-text">Linux</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Windows"><span class="nav-text">Windows</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-text">部署前端代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF"><span class="nav-text">后端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E5%90%8E%E7%AB%AF%E7%8E%AF%E5%A2%83"><span class="nav-text">配置本地后端环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C%E5%90%8E%E7%AB%AF"><span class="nav-text">本地运行后端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E4%BF%AE%E6%94%B9%E7%9A%84%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-text">部署修改的后端代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E9%95%9C%E5%83%8F"><span class="nav-text">打包镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9C%A8%E6%AD%A4%E4%B9%8B%E5%89%8D%EF%BC%9A%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%9C%A8%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%8A%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AAdocker%E7%9A%84%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E3%80%82"><span class="nav-text">(1) 在此之前：我们需要在阿里云上注册一个docker的镜像仓库。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%B0%86onlinejudge%E6%81%A2%E5%A4%8D%E5%88%B0%E6%9C%80%E5%88%9D%E5%A7%8B%E7%9A%84%E7%8A%B6%E6%80%81%EF%BC%8C%E5%B0%B1%E6%98%AF%E4%BD%A0%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E5%AE%8C%E6%AF%95%E9%82%A3%E4%B8%AA%E7%8A%B6%E6%80%81%E3%80%82%EF%BC%88%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E4%B8%8A%E4%B8%80%E6%AD%A5%E6%9B%B4%E6%94%B9%E8%BF%87docker-compose-yml-%E6%96%87%E4%BB%B6%EF%BC%8C%E8%AE%B0%E5%BE%97%E6%94%B9%E5%9B%9E%E6%9D%A5%E5%B9%B6%E9%87%8D%E6%96%B0docker-compose-up-d%EF%BC%89"><span class="nav-text">(2) 然后我们需要将onlinejudge恢复到最初始的状态，就是你一键安装完毕那个状态。（如果你在上一步更改过docker-compose.yml 文件，记得改回来并重新docker-compose up -d）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%84%B6%E5%90%8E%E5%88%87%E6%8D%A2%E5%88%B0%E6%88%91%E4%BB%AC%E4%BF%AE%E6%94%B9%E8%BF%87%E7%9A%84%E5%89%8D%E7%AB%AF%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B-%E5%85%88%E6%9F%A5%E7%9C%8B%E4%B8%8B%E6%88%91%E4%BB%AC%E5%89%8D%E7%AB%AF%E9%95%9C%E5%83%8F%E7%9A%84ID"><span class="nav-text">(3) 然后切换到我们修改过的前端的目录下,先查看下我们前端镜像的ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%85%88%E6%8A%8Aoj-backend%E7%9A%84%E5%AE%B9%E5%99%A8ID%E6%8B%B7%E8%B4%9D%E4%B8%8B%E6%9D%A5%EF%BC%8C%E4%B8%80%E4%BC%9A%E8%A6%81%E7%94%A8%E3%80%82"><span class="nav-text">(4) 先把oj-backend的容器ID拷贝下来，一会要用。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%89%93%E5%8C%85%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BF%98%E6%98%AF%E6%8A%8Adist%E9%87%8C%E7%9A%84%E5%86%85%E5%AE%B9%E6%B3%A8%E5%85%A5%E5%88%B0docker%E5%AE%B9%E5%99%A8%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E6%89%A7%E8%A1%8C"><span class="nav-text">(5) 打包完成后，我们还是把dist里的内容注入到docker容器中，我们执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E7%84%B6%E5%90%8E%E5%B0%86%E6%B3%A8%E5%85%A5%E5%90%8E%E7%9A%84%E5%AE%B9%E5%99%A8%E6%89%93%E5%8C%85%E6%88%90%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="nav-text">(6) 然后将注入后的容器打包成本地镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E6%8A%8A%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84%E9%95%9C%E5%83%8Fpush%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E4%BB%93%E5%BA%93"><span class="nav-text">(7) 把打包好的镜像push到阿里云仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-text">(8) 拉取镜像</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E7%AF%87"><span class="nav-text">迁移篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%A4%87%E4%BB%BD"><span class="nav-text">如何备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E5%A4%87%E4%BB%BD"><span class="nav-text">恢复备份</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E8%AF%84%E6%B5%8B%E6%9C%BA"><span class="nav-text">多个评测机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E9%83%A8%E7%BD%B2%E5%A5%BD%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%E5%BC%80%E5%90%AF%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%90%8C%E6%AD%A5-master-%E6%9C%8D%E5%8A%A1"><span class="nav-text">在部署好的机器上开启测试用例同步 master 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E6%96%B0%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%85%8D%E7%BD%AE-JudgeServer-%E5%92%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%90%8C%E6%AD%A5-slave-%E6%9C%8D%E5%8A%A1"><span class="nav-text">在新的机器上配置 JudgeServer 和测试用例同步 slave 服务</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
